---
import BaseLink from "./BaseLink.astro";

const base = import.meta.env.BASE_URL.replace(/\/$/, "");
const rawPath = Astro.url.pathname;
const path = rawPath.startsWith(base) ? rawPath.slice(base.length) || "/" : rawPath;
const is = (p) => path === p ? { 'aria-current': 'page', class: 'active' } : {};
---
<header class="sitebar">
  <div class="bar wrap">
    <BaseLink href="/" class="brand pill">Rifqy Hazim HR</BaseLink>
    <nav class="pills">
      <BaseLink href="/about"     {...is('/about')}>About</BaseLink>
      <BaseLink href="/updates"   {...is('/updates')}>Updates</BaseLink>
      <BaseLink href="/industry"  {...is('/industry')}>Playbooks</BaseLink>
      <BaseLink href="/works"     {...is('/works')}>Works</BaseLink>
      <BaseLink href="/projects"  {...is('/projects')}>Projects</BaseLink>
      <BaseLink href="/contact"   {...is('/contact')}>Contact</BaseLink>
      <button id="themeToggle" class="pill" type="button" aria-label="Theme toggle">â€¦</button>
    </nav>
  </div>
</header>

<script>
  const R = document.documentElement;
  const btn = document.getElementById('themeToggle');
  const KEY = 'rh-theme';
  const label = () => R.dataset.theme === 'dark' ? 'ðŸŒ™ Night' : 'â˜€ï¸ Day';

  // set theme awal
  const saved = localStorage.getItem(KEY);
  if (!saved) {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    R.dataset.theme = prefersDark ? 'dark' : 'light';
  } else {
    R.dataset.theme = saved;
  }
  btn.textContent = label();

  // toggle
  btn.addEventListener('click', () => {
    R.dataset.theme = (R.dataset.theme === 'dark') ? 'light' : 'dark';
    localStorage.setItem(KEY, R.dataset.theme);
    btn.textContent = label();
  });
</script>
